-- 전체1. W5 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 36 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체1. W5 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 43 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체1. W5 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 50 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체1. W5 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 57 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체1. W5 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 64 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
UNION ALL
-- 전체2. W13 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 92 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체2. W13 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 99 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체2. W13 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 106 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체2. W13 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 113 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체2. W13 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 120 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
UNION ALL
-- 전체3. W52 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 365 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체3. W52 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 372 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체3. W52 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 379 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체3. W52 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 386 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
-- 전체3. W52 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'ALL' AS LEV1
      ,'ALL' AS LEV2
      ,'법인전체' AS KOR_NM
      ,'TOTAL'    AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 393 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
UNION ALL
-- 본부1. W5 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B 
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 36 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부1. W5 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 43 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부1. W5 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 50 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부1. W5 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 57 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부1. W5 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 64 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 본부2. W13 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 92 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부2. W13 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 99 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부2. W13 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 106 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부2. W13 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 113 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부2. W13 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 120 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 본부3. W52 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 365 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부3. W52 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 372 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부3. W52 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 379 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부3. W52 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 386 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 본부3. W52 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,Z.ENG_NM AS LEV1
      ,'ALL'    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 393 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT DIVISION_CODE AS DIV_CD
              ,DISPLAY_NAME1 AS KOR_NM
              ,DISPLAY_NAME2 AS ENG_NM
              ,DISPLAY_ORDER_SEQ AS DISP_SEQ
        FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
        WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
        AND    USE_FLAG = 'Y' ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 사업부1. W5 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B 
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 36 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부1. W5 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 43 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부1. W5 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 50 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부1. W5 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 57 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부1. W5 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 64 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 사업부2. W13 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 92 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부2. W13 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 99 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부2. W13 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 106 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부2. W13 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 113 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부2. W13 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 120 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 사업부3. W52 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 365 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부3. W52 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 372 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부3. W52 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 379 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부3. W52 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 386 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 사업부3. W52 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,MAX(Z.LEV1) AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B     
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 393 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIV_CD
              ,A.KOR_NM
              ,A.ENG_NM 
              ,B.ENG_NM AS LEV1
        FROM   (
                SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('PIPELINE')
               ) A
              ,(SELECT DIVISION_CODE AS DIV_CD
                      ,DISPLAY_NAME1 AS KOR_NM
                      ,DISPLAY_NAME2 AS ENG_NM
                      ,DISPLAY_ORDER_SEQ AS DISP_SEQ
                FROM   IPTDW.IPTDW_RES_DIM_CORP_DISPLAY_MASTER
                WHERE  CODE_TYPE IN ('BB_RATIO_UP','BB_RATIO')
               ) B
        WHERE  A.DIV_CD = B.DIV_CD ) Z
WHERE  A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
/*
UNION ALL
-- 제품1. W5 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 36 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품1. W5 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 43 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품1. W5 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 50 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품1. W5 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 57 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품1. W5 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W5' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 64 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 제품2. W13 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 92 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품2. W13 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 99 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품2. W13 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 106 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품2. W13 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 113 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품2. W13 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W13' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 120 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
UNION ALL
-- 제품3. W52 가장최근
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME < '20151210'
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 365 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품3. W52 가장최근 - 1
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 7 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 372 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품3. W52 가장최근 - 2
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 14 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 379 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품3. W52 가장최근 - 3
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 21 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 386 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
-- 제품3. W52 가장최근 - 4
UNION ALL
SELECT MAX(C.BASE_YYYYWW) AS BASE_YYYYWW
      ,'HE' AS LEV1
      ,Z.ENG_NM    AS LEV2
      ,MAX(Z.KOR_NM) AS KOR_NM
      ,MAX(Z.ENG_NM) AS ENG_NM
      ,'W52' AS KPI_CD
      ,CASE COALESCE(SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END),0)
            WHEN 0 THEN 0
            ELSE SUM(CASE A.KPI_CD WHEN 'AWARD' THEN A.CURRM_USD_AMT END) / SUM(CASE A.KPI_CD WHEN 'SALES' THEN A.CURRM_USD_AMT END) END  AS BB_RATIO
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY A
      ,IPTDW.IPTDW_RES_DIM_MST_DIV_PROD_MAPPING B
      ,(SELECT DISTINCT A.CODE_ID AS BASE_YYYYWW
        FROM   IPTDW.IPTDW_RES_DIM_CODES A
              ,IPTDW.IPTDW_RES_DIM_CODES B
        WHERE  A.CODE_TYPE = 'SMART_WEEK'
        AND    A.CODE_TYPE = B.CODE_TYPE
        AND    A.CODE_NAME <  TO_CHAR(to_date('20151210', 'YYYYMMDD') - 28 DAY, 'YYYYMMDD')
        AND    B.CODE_NAME >= TO_CHAR(to_date('20151210', 'YYYYMMDD') - 393 DAY, 'YYYYMMDD')
        AND    A.CODE_ID   >= B.CODE_ID ) C
      ,(SELECT A.DIVISION_CODE AS DIV_CD
              ,A.PRODUCT_LEVEL4_CODE
              ,A.LEVEL_KEY_CODE
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS KOR_NM
              ,CASE A.LEVEL_KEY_CODE
                    WHEN 'GNT_L4_1' THEN 'TV 사이니지'
                    WHEN 'GNT_L4_2' THEN 'HOTEL TV' END AS ENG_NM
        FROM   IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_MAPPING_IF A
              ,IPTDW.IPTDW_RES_DIM_WEEKLY_PROD_LEVEL_IF B
        WHERE  A.LEVEL_KEY_CODE IN ('GNT_L4_1' -- 제품TV 사이니지
                                   ,'GNT_L4_2','BIZ_B3_L4_GNT_3') -- 제품HOTEL TV
       ) Z
WHERE  A.DIV_CD = 'GNT'
AND    A.DIV_CD = B.DIVISION_CODE
AND    A.DIV_CD = Z.DIV_CD
AND    A.ZONE_RNR_CD = Z.PRODUCT_LEVEL4_CODE
AND    A.CAT_CD = 'BEP_SMART_BB'
AND    A.SUBSDR_CD = 'ESPS'
AND    A.APPLY_YYYYMM = C.BASE_YYYYWW
GROUP BY Z.ENG_NM
*/