/*
DELETE 
FROM   IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY
WHERE  CAT_CD = 'BEP_SMART_ML'
;
*/

INSERT INTO IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY
(
   BASE_YYYYMM
  ,SCENARIO_TYPE_CD
  ,DIV_CD
  ,SUBSDR_CD
  ,AU_CD
  ,MANUAL_ADJ_FLAG
  ,KPI_CD
  ,CAT_CD
  ,SUB_CAT_CD
  ,ZONE_RNR_CD
  ,SUBSDR_RNR_CD
  ,CNTRY_CD
  ,APPLY_YYYYMM
  ,CURRM_USD_AMT
  ,ATTRIBUTE1_VALUE
  ,ATTRIBUTE2_VALUE
  ,ATTRIBUTE3_VALUE
  ,ATTRIBUTE4_VALUE
  ,CREATION_DATE
  ,CREATION_USR_ID
  ,LAST_UPD_DATE
  ,LAST_UPD_USR_ID
)
SELECT ATTRIBUTE3  AS BASE_YYYYMM          
      ,ATTRIBUTE6  AS SCENARIO_TYPE_CD          
      ,ATTRIBUTE10 AS DIV_CD          
      ,ATTRIBUTE9  AS SUBSDR_CD          
      ,ATTRIBUTE8  AS AU_CD                 
      ,'N'         AS MANUAL_ADJ_FLAG            
      ,CASE ATTRIBUTE11
            WHEN 'NSALES' THEN 'SALE'
            ELSE ATTRIBUTE11 END AS KPI_CD          
      ,'BEP_SMART_ML' AS CAT_CD    
      ,ATTRIBUTE9  AS SUB_CAT_CD          
      ,YYYYMMDD  AS ZONE_RNR_CD          
      ,ATTRIBUTE9  AS SUBSDR_RNR_CD         
      ,'*'         AS CNTRY_CD                
      ,ATTRIBUTE4  AS APPLY_YYYYMM
      ,TO_NUMBER(ATTRIBUTE12) AS CURRM_USD_AMT
      ,ATTRIBUTE1          
      ,ATTRIBUTE2
      ,SUBSTR(ATTRIBUTE3,1,4)||'W'||SUBSTR('0'||WEEK_ISO(to_date(ATTRIBUTE1, 'YYYYMMDD')),1,2)
      ,SUBSTR(ATTRIBUTE3,1,4)||'W'||SUBSTR('0'||WEEK_ISO(to_date(ATTRIBUTE2, 'YYYYMMDD')),1,2)
      ,CURRENT TIMESTAMP   
      ,'ares'              
      ,CURRENT TIMESTAMP   
      ,'ares'  
FROM   IPTDW.IPTDW_RES_N2G_EXCEL_UPLOAD_DATA
WHERE  SEQ = '1800'
AND    CODE_ID = 'BEP_SMART_MOSTLIKELY'
;