INSERT INTO IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY
(
   BASE_YYYYMM
  ,SCENARIO_TYPE_CD
  ,DIV_CD
  ,SUBSDR_CD
  ,AU_CD
  ,MANUAL_ADJ_FLAG
  ,KPI_CD
  ,CAT_CD
  ,SUB_CAT_CD
  ,ZONE_RNR_CD
  ,SUBSDR_RNR_CD
  ,CNTRY_CD
  ,APPLY_YYYYMM
  ,CURRM_KRW_AMT
  ,CURRM_USD_AMT
  ,ACCU_KRW_AMT
  ,ACCU_USD_AMT
  ,ATTRIBUTE1_VALUE
  ,ATTRIBUTE2_VALUE
  ,ATTRIBUTE3_VALUE
  ,ATTRIBUTE4_VALUE
  ,ATTRIBUTE5_VALUE
  ,CREATION_DATE
  ,CREATION_USR_ID
  ,LAST_UPD_DATE
  ,LAST_UPD_USR_ID
)
SELECT A.ATTRIBUTE1
      ,A.ATTRIBUTE14
      ,A.ATTRIBUTE2
      ,A.ATTRIBUTE8
      ,'*'
      ,'N'
      ,B.KPI_CD
      ,'BEP_SMART_PROD'
      ,NVL(A.ATTRIBUTE21,'*')
      ,NVL(A.ATTRIBUTE25,'*')
      ,A.ATTRIBUTE8
      ,'*'
      ,A.ATTRIBUTE1
      ,NULL
      ,SUM(TO_NUMBER(CASE WHEN B.KPI_CD = 'SALE' THEN A.ATTRIBUTE34
                          WHEN B.KPI_CD = 'COI'  THEN A.ATTRIBUTE38 END))
      ,NULL
      ,NULL
      ,MIN(A.ATTRIBUTE9)
      ,MIN(A.ATTRIBUTE17)
      ,MIN(A.ATTRIBUTE21)
      ,MIN(A.ATTRIBUTE25)
      ,MIN(A.ATTRIBUTE29)
      ,CURRENT TIMESTAMP
      ,'ares'
      ,CURRENT TIMESTAMP
      ,'ares'
FROM   IPTDW.IPTDW_RES_EXCEL_UPLOAD_DATA A
      ,(
       SELECT 'SALE' AS KPI_CD FROM   SYSIBM.SYSDUMMY1 UNION ALL
       SELECT 'COI'  AS KPI_CD FROM   SYSIBM.SYSDUMMY1
       ) B
WHERE  A.SEQ = '1510'
AND    A.CODE_ID = 'BEP_SMART_PROD'
GROUP BY A.ATTRIBUTE1
        ,A.ATTRIBUTE14
        ,A.ATTRIBUTE2
        ,A.ATTRIBUTE8
        ,B.KPI_CD
      ,NVL(A.ATTRIBUTE21,'*')
      ,NVL(A.ATTRIBUTE25,'*')
        ,A.ATTRIBUTE8      
WITH UR;

/*
SQL(1)          : 261312개의 행이 Delete 되었습니다. SQL 소요시간 (1.058)


모든 SQL 실행이 완료되었습니다.
전체 SQL	: 1   SQL 소요시간( 1.058 )

SQL 완료	: 1

SQL(1)          : 686692개의 행이 Insert 되었습니다. SQL 소요시간 (25.827)


모든 SQL 실행이 완료되었습니다.
전체 SQL	: 1   SQL 소요시간( 25.827 )

SQL 완료	: 1

*/