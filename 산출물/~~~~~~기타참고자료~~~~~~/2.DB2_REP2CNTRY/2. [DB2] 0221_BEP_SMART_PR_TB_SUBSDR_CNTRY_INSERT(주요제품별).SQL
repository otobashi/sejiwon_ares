INSERT INTO IPTDW.IPTDW_RES_KPI_SUBSDR_CNTRY
(
   BASE_YYYYMM
  ,SCENARIO_TYPE_CD
  ,DIV_CD
  ,SUBSDR_CD
  ,AU_CD
  ,MANUAL_ADJ_FLAG
  ,KPI_CD
  ,CAT_CD
  ,SUB_CAT_CD
  ,ZONE_RNR_CD
  ,SUBSDR_RNR_CD
  ,CNTRY_CD
  ,APPLY_YYYYMM
  ,CURRM_KRW_AMT
  ,CURRM_USD_AMT
  ,ACCU_KRW_AMT
  ,ACCU_USD_AMT
  ,ATTRIBUTE1_VALUE
  ,ATTRIBUTE2_VALUE
  ,ATTRIBUTE3_VALUE
  ,ATTRIBUTE4_VALUE
  ,CREATION_DATE
  ,CREATION_USR_ID
  ,LAST_UPD_DATE
  ,LAST_UPD_USR_ID
)

SELECT A.BASE_YYYYMM AS BASE_YYYYMM
      ,A.SCENARIO_TYPE_CD AS SCENARIO_TYPE_CD
      ,B.DIV_CD AS DIV_CD
      ,A.SUBSDR_CD AS SUBSDR_CD
      ,'*' AS AU_CD
      ,'N' AS MANUAL_ADJ_FLAG
      ,CASE WHEN A.ACCT_CD = '41000000' THEN 'SALE'
            WHEN A.ACCT_CD = '549999PL' THEN 'COI'
            WHEN A.ACCT_CD = '410000GS' THEN 'GROSS_SALE'
            WHEN A.ACCT_CD = '410000SD' THEN 'SALES_DEDUCTION'
            WHEN A.ACCT_CD = 'OH903000' THEN 'MGN_PROFIT'
            WHEN A.ACCT_CD = 'OH000000FC' THEN 'BEP_F_COST'
            ELSE A.ACCT_CD
       END AS KPI_CD
      ,'BEP_SMART_PR' AS CAT_CD
      ,A.PROD_CD AS SUB_CAT_CD
      ,'*' AS ZONE_RNR_CD
      ,A.SUBSDR_CD AS SUBSDR_RNR_CD
      ,'*' AS CNTRY_CD
      ,CASE A.SCENARIO_TYPE_CD
            WHEN 'AC0'
            THEN A.BASE_YYYYMM
            WHEN 'PR1'
            THEN TO_CHAR(TO_DATE(A.BASE_YYYYMM,'YYYYMM') + 1 MONTHS,'YYYYMM')
            WHEN 'PR2'
            THEN TO_CHAR(TO_DATE(A.BASE_YYYYMM,'YYYYMM') + 2 MONTHS,'YYYYMM')
            WHEN 'PR3'
            THEN TO_CHAR(TO_DATE(A.BASE_YYYYMM,'YYYYMM') + 3 MONTHS,'YYYYMM')
            WHEN 'PR4'
            THEN TO_CHAR(TO_DATE(A.BASE_YYYYMM,'YYYYMM') + 4 MONTHS,'YYYYMM')
            ELSE A.BASE_YYYYMM
       END AS APPLY_YYYYMM
      ,SUM(A.CURRM_KRW_AMT) AS CURRM_KRW_AMT
      ,SUM(A.CURRM_USD_AMT) AS CURRM_USD_AMT
      ,SUM(A.ACCUM_KRW_AMT) AS ACCUM_KRW_AMT
      ,SUM(A.ACCUM_USD_AMT) AS ACCUM_USD_AMT
      ,MIN(B.MGT_TYPE_CD) AS ATTRIBUTE1_VALUE
      ,MIN(B.PROD_LVL_CD) AS ATTRIBUTE2_VALUE
      ,MIN(B.PROD_ENG_NAME) AS ATTRIBUTE3_VALUE
      ,MIN(B.PROD_KOR_NAME) AS ATTRIBUTE4_VALUE
      ,CURRENT TIMESTAMP
      ,'ares'
      ,CURRENT TIMESTAMP
      ,'ares'
FROM  IPTDWIF.IPTDWIF_RES_N2G_KPI_PROD_S A
      INNER JOIN  IPTDW.IPTDW_RES_DIM_PROD_M B
      ON    B.PROD_GR_CD = A.PROD_GR_CD
      AND   B.PROD_CD    = A.PROD_CD
WHERE A.SCENARIO_TYPE_CD IN ('AC0','PR1','PR2','PR3','PR4')
AND   A.LDGR_TYPE_CD     = '1'
AND   A.SUBSDR_TYPE_CD   = 'S'
AND   A.ACCT_CD          IN ('41000000' -- SALE
                            ,'549999PL' -- COI
                            ,'410000GS' -- GROSS_SALE
                            ,'410000SD' -- SALES_DEDUCTION
                            ,'OH903000' -- MGN_PROFIT
                            ,'OH000000FC' -- BEP_F_COST
                             )
AND   A.PROD_GR_CD = 'RPT_PROD_GR'
--AND   A.PROD_CD = 'GLT_L2_1'
GROUP BY
       A.BASE_YYYYMM
      ,A.SCENARIO_TYPE_CD
      ,B.DIV_CD
      ,A.SUBSDR_CD
      ,A.ACCT_CD
      ,A.PROD_CD

